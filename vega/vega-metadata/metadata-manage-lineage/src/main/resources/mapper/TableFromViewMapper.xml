<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eisoo.mapper.TableFromViewMapper">
    <insert id="insertBatchSomeColumn">
        insert into t_lineage_tag_table2
        select fv.id                                              as unique_id,
               fv.id                                              as uuid,
               fv.technical_name,
               fv.business_name,
               fv.description                                     as comment,
               'form_view'                                        as table_type,

               fv.datasource_id,
               d.name                                             as datasource_name,
               fv.owner_id,
               u.name                                             as owner_name,
               fv.department_id,

               o.name                                             as department_name,
               d.info_system_id,
               is2.name                                           as info_system_name,
               d.`schema`                                         as database_name,
               d.catalog_name,

               concat(d.username, '@', d.host, ":", d.port)       as catalog_addr,
               d.type_name                                        as catalog_type,
               NULL                                               as task_execution_info,
               'insert'                                           as action_type,
               fv.created_at                                      as created_at,
               fv.updated_at                                      as updated_at
        from adp.form_view fv
                 left join adp.datasource d on fv.datasource_id = d.id
                 left join adp.user u on fv.owner_id = u.id
                 left join af_configuration.`object` o on o.id = fv.department_id
                 left join af_configuration.info_system is2 on is2.id = d.info_system_id
        where fv.`type` = 1
          and fv.deleted_at = 0
        ON DUPLICATE key update uuid=values(uuid),technical_name=values(technical_name),business_name=values(business_name),comment=values(comment),table_type=values(table_type),
                                datasource_id=values(datasource_id),datasource_name=values(datasource_name),owner_id=values(owner_id),owner_name=values(owner_name),department_id=values(department_id),
                                department_name=values(department_name),info_system_id=values(info_system_id),info_system_name=values(info_system_name),database_name=values(database_name),catalog_name=values(catalog_name),
                                catalog_addr=values(catalog_addr),catalog_type=values(catalog_type),task_execution_info=values(task_execution_info),action_type=values(action_type),created_at=values(created_at),updated_at=values(updated_at)
    </insert>
</mapper>
